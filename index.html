<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raindrop Taxi</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<style>
body{margin:0;background:#f2f2f2;font-family:Inter,sans-serif;}

header{
    background:black;color:white;padding:15px;
    display:flex;align-items:center;justify-content:space-between;
}

header .left{
    display:flex;align-items:center;gap:15px;
}
header img{height:45px;}

.login-btn{
    background:white;color:black;padding:10px 18px;
    border-radius:8px;text-decoration:none;font-weight:600;
}

.logout-btn{
    background:red;color:white;padding:10px 18px;
    border-radius:8px;text-decoration:none;font-weight:600;
}

.container{max-width:1200px;margin:auto;display:flex;gap:20px;padding:25px;}

.card,.side-card{
    background:white;padding:20px;border-radius:14px;
    box-shadow:0 4px 14px rgba(0,0,0,0.1);
}

.card{flex:1;}
.side-card{width:380px;}

input,select{
    width:100%;padding:12px;margin-top:10px;border-radius:10px;
    border:1px solid #ccc;font-size:16px;
}

button{
    width:100%;padding:14px;margin-top:15px;border:none;
    border-radius:10px;background:black;color:white;
    font-size:16px;font-weight:600;cursor:pointer;
}

#map{width:100%;height:250px;border-radius:10px;background:#ddd;}
</style>
</head>
<body>

<header>
    <div class="left">
        <img src="assets/logo.png">
        <h1>Raindrop Taxi</h1>
    </div>

    <div id="authButtons"></div>
</header>

<script>
// Show Login / Logout button based on session
if (localStorage.getItem("loggedIn") === "yes") {
    document.getElementById("authButtons").innerHTML = `
        <a class="logout-btn" href="#" onclick="logout()">Logout</a>
    `;
} else {
    document.getElementById("authButtons").innerHTML = `
        <a class="login-btn" href="login.html">Login</a>
    `;
}

function logout() {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("session_id");
    localStorage.removeItem("phone");
    alert("Logged out.");
    location.reload();
}
</script>

<div class="container">

    <div class="card">
        <h2>Book a Ride</h2>

        <label>Pickup location</label>
        <input id="pickup" placeholder="Enter pickup location">

        <label>Drop location</label>
        <input id="drop" placeholder="Enter drop location">

        <label>Date & Time</label>
        <input type="datetime-local" id="datetime">

        <label>Vehicle</label>
        <select id="vehicle">
            <option>Sedan</option>
            <option>SUV</option>
            <option>Mini</option>
        </select>

        <button onclick="showRoute()">Show on Map</button>
        <button onclick="bookWhatsApp()">Book on WhatsApp</button>
        <button onclick="payUPI()">Pay via UPI</button>
    </div>

    <div class="side-card">
        <h3>Driver</h3>
        <img src="assets/driver.jpg" style="width:100%;border-radius:10px">

        <h3>Vehicle</h3>
        <img src="assets/car.jpg" style="width:100%;border-radius:10px">

        <h3>Map</h3>
        <div id="map"></div>
    </div>
</div>

<script>
let map = L.map('map').setView([11.75,79.76], 10);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let routeControl;

function showRoute() {
    let p = pickup.value.trim();
    let d = drop.value.trim();

    if (!p || !d) { alert("Enter pickup and drop"); return; }

    Promise.all([
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(p)}`).then(r=>r.json()),
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}`).then(r=>r.json())
    ]).then(([a,b])=>{
        if (!a.length || !b.length) { alert("Location not found"); return; }

        let c1=[a[0].lat,a[0].lon], c2=[b[0].lat,b[0].lon];

        if (routeControl) map.removeControl(routeControl);

        routeControl = L.Routing.control({
            waypoints:[L.latLng(c1), L.latLng(c2)],
            routeWhileDragging:false
        }).addTo(map);
    });
}

function bookWhatsApp() {
    let msg = 
`Raindrop Taxi:
Pickup: ${pickup.value}
Drop: ${drop.value}
Time: ${datetime.value}
Vehicle: ${vehicle.value}`;

    window.open(`https://wa.me/919486576643?text=${encodeURIComponent(msg)}`, "_blank");
}

function payUPI() {
    window.location.href = "upi://pay?pa=prasanthvjm890-1@okhdfcbank&pn=RaindropTaxi&cu=INR";
}
</script>

</body>
</html>
